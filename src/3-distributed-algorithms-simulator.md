# 分散アルゴリズムシミュレータの役割

第1章で述べたとおり、分散アルゴリズムは社会のいたるところで活用されている。
しかし、分散アルゴリズムが生来的に備える複雑さのために、それを考案・検証するのは大変に難しい。
分散アルゴリズムシミュレータはそのような需要に応え、分散アルゴリズムの開発者にその検証環境を提供するものである。

分散アルゴリズムの検証は、どのようなアルゴリズムであっても概ね次のような作業からなる。
すなわち、

1. 初期大域状態の設定
2. イベントの生起
3. プロセスの状態遷移
4. 大域状態の確認 <!-- 改段落されないようにしたい -->

である。
アルゴリズムが複雑になると、このような作業を手作業で行うのは難しくなる。
よって、分散アルゴリズムが開発者の想定通りに動いているかを検証するために、開発者を補助するツールが必要になる。
それが分散アルゴリズムシミュレータである。

# 既存の分散アルゴリズムシミュレータ

既存の分散アルゴリズムシミュレータには単一のコンピュータ上で分散システムを模倣するBen-AriによるDAJ(Distributed Algorithms in Java)\cite{daj}や、
実際に複数のコンピュータ上で分散アルゴリズムのシミュレーションを実行できる弘田らの$D^2AS$(Distributed Distributed Algorithms Simulator)\cite{d2as}などがある。
ここではH-DASとシミュレーションの形式が似ているDAJについて説明する。

DAJは教育目的に作成された分散アルゴリズムシミュレータで、分散アルゴリズムを対話的に動作させてその様子を動的に観察することができる。
アルゴリズム例として14のアルゴリズムのソースコードが付属しており、自作のアルゴリズムを動作させることもできるようになっている。
ユーザが記述するアルゴリズムは非常にシンプルなプログラムインターフェイスのクラスライブラリを利用して簡単に作成できる。
DAJが開発される以前は、PVM\cite{pvm}やMPI\cite{mpi}などの高機能だが複雑で巨大なライブラリが多かった。
このようなライブラリは低レイアの技術的な問題を含み、また内部の情報が隠蔽されていて観察できないなど、教育目的の利用には適さなかったためDAJが開発された。

図\ref{fig:daj}はDAJの外観である。
画面を四等分しているブロックのそれぞれが分散システムを構成するプロセスを表していて、それぞれが各プロセスの状態を表している。
また、各プロセスの状態の下にあるRequestやReplyなどのボタンで、各プロセスのイベントを実行できる。
さらに最も下部に配置されているボタンでは以下のことができる。

FileX, Step, Log on/off, Auto on/off Buttons

: ログの記録、及びログのステップ実行と自動実行

Prompt on/off

: 各プロセスがメッセージを送信できるプロセスを表示する行の表示・非表示の切り替え

Trace on/off

: 実行されたイベントをテキストとして表示するウィンドウの表示・非表示の切り替え

Graphics on/off

: プロセスの関係をグラフ化して表示するウィンドウの表示・非表示の切り替え

上記の機能もまとめるとDAJではおおまかに以下のことができる。

- プロセス数を1から6個の間で自由に設定できる。
- 自作のアルゴリズムの実行
- アルゴリズムの実行例の保存
- アルゴリズムの実行例の再生
- イベントの実行履歴のテキスト表示
- プロセスの関係のグラフ化(一部のアルゴリズムに限られる)

\begin{figure}
	\centering
	\includegraphics[width=0.8\linewidth]{./src/fig/daj.eps}
	\caption{DAJの外観 \label{fig:daj}}
\end{figure}

# 本研究室で開発されてきた分散アルゴリズムシミュレータ

本研究室では平成18年度からH-DAS(H - Distributed Algorithms Simulator)という分散アルゴリズムシミュレータが開発されてきた。
H-DASは分散アルゴリズムを記述するためのデスクリプタというプログラムと、出来上がった分散アルゴリズムをシミュレートするシミュレータというプログラムからなる。

図\ref{fig:descriptor}はデスクリプタの外観である。
このプログラムを用いてユーザは

1. アルゴリズムのモデル情報の入力
2. テンプレートコードの出力
3. アルゴリズムの実装
4. ビルド <!-- 改段落されないようにしたい -->

という工程を行い、シミュレータで利用するためのdasという拡張子のファイルを生成する。

図\ref{fig:simulator}はシミュレータの外観である。
このプログラムでデスクリプタにより生成したdasファイルを読み込みシミュレーションを開始する。
以下で簡単に機能の紹介を行う。
詳細な使用方法の説明は第5章で行う。

\begin{figure}[htbp]
	\centering
	\includegraphics[width=0.8\linewidth]{./src/fig/descriptor.eps}
	\caption{H-DASのDescriptorの外観 \label{fig:descriptor}}
\end{figure}

\begin{figure}[htbp]
	\centering
	\includegraphics[width=0.8\linewidth]{./src/fig/simulator.eps}
	\caption{H-DASのSimulatorの外観 \label{fig:simulator}}
\end{figure}

## 機能

昨年度までに開発されたH-DASの主な機能について述べる。

- ユーザがJava言語によるアルゴリズムを記述できる。
- 記述されたアルゴリズムのコンパイルが可能、コンパイル成功時にクラスファイルとアルゴリズムに関するファイル(拡張子 das)を作成する。
- プロセスの個数を1から1000までの間で設定できる。
- メッセージを自動で配送できる。
- メッセージの通信遅延を模倣する。
- 通信遅延の上限は0から100まで設定できる。
- メッセージの総数を集計し表示する。
- 通信路のFIFO性を設定できる。
- 実行したシミュレーションの履歴をテキスト形式で保存できる。
- 実行したシミュレーションの履歴をコマンド形式で保存できる。
- コマンド形式で保存されたシミュレーションの再現できる。
- イベント発生時にテキストエリアに結果を表示する。
- 空イベントを実行できる。
- シミュレータとデスクリプタのヘルプマニュアル(英語)を参照できる。
- 実行したイベントを取り消し、元の状態に戻すことができる。
- イベントの生起を自動化できる。
- プロセスの故障を模倣できる。
- コータリーの選択ができる。

## 問題点

本研究で改善を加えたH-DASの問題点を述べる。

- シミュレーションを開始する際の設定画面が多く、一覧性がない。
- イベントの発生回数が表示されないので、シミュレーションが開始してからの進度がわかりにくい。
- 大量のイベントを発生させ続けるとプログラムが強制終了する。
- 通信路にFIFO性を設定したときに通信遅延の制約が守られない。
- 大量のプロセスからなるシステムをシミュレートすると実行速度が極端に低下する。
- 特定の環境でプロセスの色付けがなされない。
