# 分散システム

<!--
- 分散システムの説明
- 分散システムの利点
- 分散システムの欠点
-->

分散システムは、通信ネットワークにより結合された複数のプロセス上で、共通の目的の計算をするためのシステムである。
分散システムは通常は複数のコンピュータを用いて構成されるため、物理的な共有メモリを持たない。
さらにプロセス間のメッセージ通信には遅延があり、それがどれほどの大きさかもわからないため、ある2つのプロセスでそれぞれ実行されたイベントのうち、
どちらが物理的に先に実行されたものなのかは区別できない。
ここでいうイベントとは、プロセスが行う意味的にまとまった処理のことを指し、
たとえば、関数の実行開始・実行終了やプロセス間を行き交うメッセージの送信・受信などが当てはまる。

このようなモデルを用いる利点は以下のとおりである。

- 負荷分散、機能分散により処理を高速化できる。
- システムを構成しているいくつかのコンピュータが故障してもシステム全体で処理を継続できる。
- 複数の低価格なコンピュータでシステムを構成するため、低コストである。
- コンピュータの追加、削除を容易に行えるため拡張性が高い。

## 同期システムと非同期システム

分散システムは、プロセスの実行速度、通信遅延、局所時計の非同期差の程度によって、同期システムと非同期システムに大別される。
以下の3つの条件を満たす分散システムを同期システムと呼ぶ~\cite{da}。

- プロセスの実行速度に定数の下限が存在する。
- 通信にかかる通信遅延に定数の上限が存在する。
- 分散システム全体に共通して流れる時間において、すべてのプロセス$P_i$の局所時計の値$clock_i$は等しい。

これらの条件を1つでも満たさない分散システムが非同期システムであるが、その非同期さには程度の差が大きく、特に以下の3つの条件を満たす非同期システムを完全非同期システムと呼ぶ。

- プロセスの実行速度に対してどのような過程も設けない。ただし、あるプロセスがある命令を実行しようとしたときには、有限時間内にその命令が実行されることだけは仮定する。
- 通信遅延に対してどのような過程も設けない。ただし通信遅延は有限である。
- 局所時計の差に対してどのような過程も設けない。ただし、局所時間の修正は可能である。

分散システムが実現される通信ネットワークは様々であり、同期システムの条件を仮定することは難しいので、本研究では分散システムを完全非同期システムでない非同期システムと仮定している。

<!-- H-DASの非同期さの度合いについて明示したほうが良い -->

## 分散計算のモデル

分散計算は分散システム上で生起するイベントの集合としてモデル化できる。
イベントの集合には順序関係が定義され、その関係の種類により分散計算のモデルは以下の3つに分けられる。

Interleaving Model

: 分散システム上で生起するすべてのイベントの間に全順序が定まる。

Happend Before Model

: 異なるプロセスで生起するすべてのイベントの間に半順序が、同一のプロセスで生起するすべてのイベントの間に全順序が定まる。

Potential Causality Model

: 分散システム上で生起するすべてのイベントの間に半順序が定まる。

H-DASではInterleaving Modelを採用している。
Happend Before ModelやPotential Causality Modelの分散計算もInterleaving Modelを用いて実現可能である。
なぜなら、Happened Before Modelの1つの計算結果は有限個のInterleaving Modelによる計算結果と等価であり、
Potential Causality Modelの1つの計算結果は有限このHappened Before Modelによる計算結果と等価であるからである。

<!-- 等価な理由が謎、あとInterleaving Modelを採用するとユーザには同関係があるのか明示するべき -->

# 分散アルゴリズム

分散アルゴリズムは、ある共通の目的を達成するために分散システム上のプロセスが行う計算の手順を定めたものである。
分散アルゴリズムでは共有メモリを利用できないため、アルゴリズム実行開始直後の各プロセスは自身の局所情報しか知ることができない。
そのため分散アルゴリズムでは、各プロセスがメッセージの送受信により互いの情報を交換することで処理を進める。

## 分散アルゴリズムの評価

分散アルゴリズムの性能を評価するための尺度として、通信複雑度と時間複雑度がある。
通信複雑度は、アルゴリズムの実行開始から実行終了までにプロセスの間で交換されたすべてのメッセージの総和であるメッセージ複雑度と、
プロセス間で交換されるメッセージに含まれるすべてのビット数の総和であるビット複雑度を合わせたものである。 <!-- 要出典 -->
時間複雑度とは実行開始から実行停止までに生じたメッセージの最長鎖に属するメッセージの総数である。
ここで鎖とは最初のメッセージを除く他の全メッセージが直前のメッセージの受信に酔って諸ゆ時多様なメッセージ列のことをいう。

メッセージ複雑度は、分散システムが一度に1つのメッセージしか送れないという仮定のもとで、アルゴリズムの実行時間の評価とみなせる。
時間複雑度は、分散システムが一度に可能なかぎりのメッセージを送信するという仮定のもとで、アルゴリズムの実行時間の評価とみなせる。

## 論理時計

分散システムはそれぞれが異なる時刻を持つ複数のコンピュータから構成される。
そのため、それらのコンピュータは各々が実行したイベントと、ほかのコンピュータにより実行されたイベントのどちらが物理的に先に実行されたのか知ることができない。
しかし、実際にはそれぞれのコンピュータは物理的な時間による時計でイベントの発生時刻を定義する必要はなく、すべてのコンピュータで合意が取れた時計を用いれば十分である。
そのようにして考えだされた時計が論理時計である。

論理時計には様々な種類が存在するが、H-DASではDirect Dependency Clockを用いている。
この時計を用いる場合、プロセスは通信のたびにメッセージにただ1つの整数だけを付与するため、通信パケットの大きさがほとんど変化しない。
以下にDirect Dependency Clockのアルゴリズムを記述する。

